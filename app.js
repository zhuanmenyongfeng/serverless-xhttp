const _0x56bbe2=_0x1987;(function(_0x264637,_0x3fe15c){const _0x2234dc=_0x1987,_0x1033a1=_0x264637();while(!![]){try{const _0x4de7bf=-parseInt(_0x2234dc(0x1f5))/0x1+-parseInt(_0x2234dc(0x1a2))/0x2*(-parseInt(_0x2234dc(0x29a))/0x3)+parseInt(_0x2234dc(0x16f))/0x4+-parseInt(_0x2234dc(0x26f))/0x5+-parseInt(_0x2234dc(0x1c4))/0x6*(parseInt(_0x2234dc(0x247))/0x7)+parseInt(_0x2234dc(0x23f))/0x8+parseInt(_0x2234dc(0x1d8))/0x9;if(_0x4de7bf===_0x3fe15c)break;else _0x1033a1['push'](_0x1033a1['shift']());}catch(_0x5155c9){_0x1033a1['push'](_0x1033a1['shift']());}}}(_0x27d8,0xb285e));const os=require('os'),fs=require('fs'),net=require('net'),dns=require('dns'),http=require(_0x56bbe2(0x16a)),axios=require(_0x56bbe2(0x1dd)),{Buffer}=require(_0x56bbe2(0x1df)),{exec}=require(_0x56bbe2(0x19e)),UUID=process['env'][_0x56bbe2(0x16b)]||_0x56bbe2(0x171),NEZHA_SERVER=process['env'][_0x56bbe2(0x1ee)]||'',NEZHA_PORT=process[_0x56bbe2(0x23a)]['NEZHA_PORT']||'',NEZHA_KEY=process[_0x56bbe2(0x23a)]['NEZHA_KEY']||'',AUTO_ACCESS=process[_0x56bbe2(0x23a)][_0x56bbe2(0x1d0)]||![],XPATH=process[_0x56bbe2(0x23a)][_0x56bbe2(0x251)]||UUID[_0x56bbe2(0x28b)](0x0,0x8),SUB_PATH=process[_0x56bbe2(0x23a)][_0x56bbe2(0x24f)]||'sb',DOMAIN=process[_0x56bbe2(0x23a)][_0x56bbe2(0x1bd)]||'',NAME=process[_0x56bbe2(0x23a)][_0x56bbe2(0x1a6)]||'',PORT=process[_0x56bbe2(0x23a)][_0x56bbe2(0x235)]||0xbb8,SETTINGS={[_0x56bbe2(0x16b)]:UUID,[_0x56bbe2(0x233)]:_0x56bbe2(0x210),[_0x56bbe2(0x284)]:_0x56bbe2(0x207),['XPATH']:_0x56bbe2(0x1e7)+XPATH,['MAX_BUFFERED_POSTS']:0x32,[_0x56bbe2(0x1d6)]:0x1e8480,['SESSION_TIMEOUT']:0x7530,[_0x56bbe2(0x23e)]:0x40*0x400,[_0x56bbe2(0x231)]:!![],[_0x56bbe2(0x25c)]:!![],[_0x56bbe2(0x21f)]:0xea60,[_0x56bbe2(0x1dc)]:0x493e0,['CONNECTION_POOL_SIZE']:0x64,['WRITE_BUFFER_SIZE']:0x40*0x400,['READ_BUFFER_SIZE']:0x40*0x400,[_0x56bbe2(0x1d5)]:0xa,[_0x56bbe2(0x170)]:![]},customDnsResolver={'servers':[_0x56bbe2(0x217),_0x56bbe2(0x1fe)],'currentServerIndex':0x0,async 'resolve'(_0x4ed260){const _0x4d7ec7=_0x56bbe2,_0x3f5337=this['servers'];let _0x2ba915;for(let _0x27963a=0x0;_0x27963a<_0x3f5337[_0x4d7ec7(0x1a5)];_0x27963a++){const _0x3b9a4a=(this[_0x4d7ec7(0x26b)]+_0x27963a)%_0x3f5337[_0x4d7ec7(0x1a5)],_0x2df5c6=_0x3f5337[_0x3b9a4a];try{log(_0x4d7ec7(0x2a4),_0x4d7ec7(0x26c)+_0x4ed260+_0x4d7ec7(0x185)+_0x2df5c6);const _0x10b1b0=await this[_0x4d7ec7(0x200)](_0x4ed260,_0x2df5c6);return this[_0x4d7ec7(0x26b)]=(_0x3b9a4a+0x1)%_0x3f5337[_0x4d7ec7(0x1a5)],log(_0x4d7ec7(0x2a4),_0x4d7ec7(0x27d)+_0x4ed260+_0x4d7ec7(0x22b)+_0x10b1b0+_0x4d7ec7(0x24a)+_0x2df5c6),_0x10b1b0;}catch(_0x1c4b51){_0x2ba915=_0x1c4b51,log(_0x4d7ec7(0x2a9),_0x4d7ec7(0x287)+_0x2df5c6+':\x20'+_0x1c4b51['message']);}}throw new Error(_0x4d7ec7(0x20a)+_0x2ba915?.[_0x4d7ec7(0x173)]);},async 'resolveWithServer'(_0x3c0aee,_0x5857a0){return new Promise((_0x46c2e7,_0x782759)=>{const _0x143b83=_0x1987,_0x3fe72=require(_0x143b83(0x299)),_0x13698b=_0x3fe72[_0x143b83(0x245)]();_0x3fe72[_0x143b83(0x213)]([_0x5857a0]),_0x3fe72[_0x143b83(0x255)](_0x3c0aee,(_0x3a2dca,_0x40b540)=>{const _0x33a777=_0x143b83;_0x3fe72[_0x33a777(0x213)](_0x13698b);if(_0x3a2dca)_0x782759(_0x3a2dca);else _0x40b540&&_0x40b540[_0x33a777(0x1a5)]>0x0?_0x46c2e7(_0x40b540[0x0]):_0x782759(new Error(_0x33a777(0x246)));});});}};dns[_0x56bbe2(0x1e6)](_0x56bbe2(0x29e)),dns[_0x56bbe2(0x213)](['1.1.1.1',_0x56bbe2(0x1fe)]);function validate_uuid(_0x4911b1,_0x45cd7e){for(let _0x4b4abb=0x0;_0x4b4abb<0x10;_0x4b4abb++){if(_0x4911b1[_0x4b4abb]!==_0x45cd7e[_0x4b4abb])return![];}return!![];}function concat_typed_arrays(_0x5c6f78,..._0x661147){const _0x28e890=_0x56bbe2;if(!_0x661147||_0x661147[_0x28e890(0x1a5)]<0x1)return _0x5c6f78;let _0x4ccf0b=_0x5c6f78[_0x28e890(0x1a5)];for(let _0x24be4b of _0x661147)_0x4ccf0b+=_0x24be4b[_0x28e890(0x1a5)];const _0x404933=new _0x5c6f78[(_0x28e890(0x1ba))](_0x4ccf0b);_0x404933[_0x28e890(0x24e)](_0x5c6f78,0x0),_0x4ccf0b=_0x5c6f78['length'];for(let _0x3f51a4 of _0x661147){_0x404933[_0x28e890(0x24e)](_0x3f51a4,_0x4ccf0b),_0x4ccf0b+=_0x3f51a4[_0x28e890(0x1a5)];}return _0x404933;}function log(_0x575e8e,..._0x523d62){const _0x4d8fa5=_0x56bbe2;if(SETTINGS[_0x4d8fa5(0x233)]===_0x4d8fa5(0x210))return;const _0x39bdd8={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x81e7d6={'debug':_0x4d8fa5(0x2a0),'info':'\x1b[32m','warn':_0x4d8fa5(0x21b),'error':_0x4d8fa5(0x1a9),'reset':_0x4d8fa5(0x291)},_0x7b091b=_0x39bdd8[SETTINGS[_0x4d8fa5(0x233)]]||0x1,_0x31907a=_0x39bdd8[_0x575e8e]||0x0;if(_0x31907a>=_0x7b091b){const _0x455f29=new Date()[_0x4d8fa5(0x27e)](),_0x4c550c=_0x81e7d6[_0x575e8e]||_0x81e7d6[_0x4d8fa5(0x208)];console[_0x4d8fa5(0x25b)](_0x4c550c+'['+_0x455f29+_0x4d8fa5(0x203)+_0x575e8e+']',..._0x523d62,_0x81e7d6[_0x4d8fa5(0x208)]);}}const getDownloadUrl=()=>{const _0x3a6e84=_0x56bbe2,_0x3c781b=os['arch']();return _0x3c781b===_0x3a6e84(0x243)||_0x3c781b===_0x3a6e84(0x261)||_0x3c781b===_0x3a6e84(0x1d3)?!NEZHA_PORT?_0x3a6e84(0x1cc):_0x3a6e84(0x244):!NEZHA_PORT?_0x3a6e84(0x254):_0x3a6e84(0x281);},downloadFile=async()=>{const _0x3ba73e=_0x56bbe2;if(!NEZHA_KEY)return;try{const _0x38becc=getDownloadUrl(),_0x14827c=await axios({'method':'get','url':_0x38becc,'responseType':'stream'}),_0x4ff5e9=fs[_0x3ba73e(0x271)](_0x3ba73e(0x188));return _0x14827c[_0x3ba73e(0x27a)][_0x3ba73e(0x1e4)](_0x4ff5e9),new Promise((_0x3f532e,_0x31036c)=>{_0x4ff5e9['on']('finish',()=>{const _0x20e2c7=_0x1987;console[_0x20e2c7(0x25b)](_0x20e2c7(0x2a5)),exec('chmod\x20+x\x20npm',_0x18e43d=>{if(_0x18e43d)_0x31036c(_0x18e43d);_0x3f532e();});}),_0x4ff5e9['on']('error',_0x31036c);});}catch(_0x35db14){throw _0x35db14;}},runnz=async()=>{const _0x40ad8b=_0x56bbe2;await downloadFile();let _0x5e160c='',_0x5aff2e='';if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x2126bc=[_0x40ad8b(0x272),'8443','2096',_0x40ad8b(0x18f),_0x40ad8b(0x1ed),_0x40ad8b(0x167)];_0x5e160c=_0x2126bc[_0x40ad8b(0x241)](NEZHA_PORT)?_0x40ad8b(0x27c):'',_0x5aff2e='nohup\x20./npm\x20-s\x20'+NEZHA_SERVER+':'+NEZHA_PORT+_0x40ad8b(0x220)+NEZHA_KEY+'\x20'+_0x5e160c+_0x40ad8b(0x288);}else{if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x18140c=NEZHA_SERVER[_0x40ad8b(0x241)](':')?NEZHA_SERVER[_0x40ad8b(0x230)](':')[_0x40ad8b(0x292)]():'',_0x2af90a=new Set([_0x40ad8b(0x272),_0x40ad8b(0x268),_0x40ad8b(0x27b),_0x40ad8b(0x18f),_0x40ad8b(0x1ed),_0x40ad8b(0x167)]),_0x3db04e=_0x2af90a['has'](_0x18140c)?'true':_0x40ad8b(0x1a0),_0x3b0aa7=_0x40ad8b(0x19d)+NEZHA_KEY+_0x40ad8b(0x1ce)+NEZHA_SERVER+_0x40ad8b(0x1bc)+_0x3db04e+_0x40ad8b(0x169)+UUID;fs[_0x40ad8b(0x1c5)](_0x40ad8b(0x294),_0x3b0aa7);}_0x5aff2e=_0x40ad8b(0x278);}else return;}try{exec(_0x5aff2e,{'shell':'/bin/bash'}),console['log']('npm\x20is\x20running');}catch(_0xbe7a16){console[_0x40ad8b(0x1b9)](_0x40ad8b(0x250)+_0xbe7a16);}};async function addAccessTask(){const _0x1ca725=_0x56bbe2;if(AUTO_ACCESS!==!![])return;try{if(!DOMAIN)return;const _0x38c3f5=_0x1ca725(0x1e2)+DOMAIN,_0x3fc69c=_0x1ca725(0x1a8)+_0x38c3f5+_0x1ca725(0x216);exec(_0x3fc69c,(_0xa755a4,_0x2dc4c1,_0x3356ff)=>{const _0x40ff49=_0x1ca725;if(_0xa755a4){console[_0x40ff49(0x1b9)]('Error\x20sending\x20request:',_0xa755a4[_0x40ff49(0x173)]);return;}console['log'](_0x40ff49(0x16c),_0x2dc4c1);});}catch(_0x21c80b){console[_0x1ca725(0x1b9)]('Error\x20added\x20Task:',_0x21c80b[_0x1ca725(0x173)]);}}function parse_uuid(_0x468fa3){const _0x262438=_0x56bbe2;_0x468fa3=_0x468fa3[_0x262438(0x1c9)]('-','');const _0x47c0db=[];for(let _0x3dc44f=0x0;_0x3dc44f<0x10;_0x3dc44f++){_0x47c0db[_0x262438(0x1c0)](parseInt(_0x468fa3['substr'](_0x3dc44f*0x2,0x2),0x10));}return _0x47c0db;}async function read_vless_header(_0x50490e,_0xfe829a){const _0x1f6071=_0x56bbe2;let _0x40de32=0x0,_0x13ffd8=new Uint8Array(),_0x4dfe54={'value':_0x13ffd8,'done':![]};async function _0x35203c(_0x5d8af5){const _0x1b8f98=_0x1987;if(_0x4dfe54[_0x1b8f98(0x1f3)])throw new Error(_0x1b8f98(0x222));const _0x82a62b=_0x5d8af5-_0x40de32;if(_0x82a62b<0x1)return;_0x4dfe54=await read_atleast(_0x50490e,_0x82a62b),_0x40de32+=_0x4dfe54[_0x1b8f98(0x1d9)][_0x1b8f98(0x1a5)],_0x13ffd8=concat_typed_arrays(_0x13ffd8,_0x4dfe54[_0x1b8f98(0x1d9)]);}await _0x35203c(0x1+0x10+0x1);const _0x53f2f7=_0x13ffd8[0x0],_0x1138f4=_0x13ffd8[_0x1f6071(0x28b)](0x1,0x1+0x10),_0x5f1ef4=parse_uuid(_0xfe829a);if(!validate_uuid(_0x1138f4,_0x5f1ef4))throw new Error(_0x1f6071(0x1e0));const _0x4a5219=_0x13ffd8[0x1+0x10],_0x3109fb=0x1+0x10+0x1+_0x4a5219+0x1+0x2+0x1;await _0x35203c(_0x3109fb+0x1);const _0x186834=_0x13ffd8[0x1+0x10+0x1+_0x4a5219],_0x44bcaa=0x1;if(_0x186834!==_0x44bcaa)throw new Error('unsupported\x20command:\x20'+_0x186834);const _0x163233=(_0x13ffd8[_0x3109fb-0x1-0x2]<<0x8)+_0x13ffd8[_0x3109fb-0x1-0x1],_0x15690d=_0x13ffd8[_0x3109fb-0x1],_0x1297a4=0x1,_0x1ae1bd=0x2,_0x515ef7=0x3;let _0x430aff=-0x1;if(_0x15690d===_0x1297a4)_0x430aff=_0x3109fb+0x4;else{if(_0x15690d===_0x515ef7)_0x430aff=_0x3109fb+0x10;else _0x15690d===_0x1ae1bd&&(_0x430aff=_0x3109fb+0x1+_0x13ffd8[_0x3109fb]);}if(_0x430aff<0x0)throw new Error('read\x20address\x20type\x20failed');await _0x35203c(_0x430aff);const _0x2415df=_0x3109fb;let _0x47aec4='';if(_0x15690d===_0x1297a4)_0x47aec4=_0x13ffd8[_0x1f6071(0x28b)](_0x2415df,_0x2415df+0x4)['join']('.');else{if(_0x15690d===_0x1ae1bd)_0x47aec4=new TextDecoder()['decode'](_0x13ffd8[_0x1f6071(0x28b)](_0x2415df+0x1,_0x2415df+0x1+_0x13ffd8[_0x2415df]));else _0x15690d===_0x515ef7&&(_0x47aec4=_0x13ffd8[_0x1f6071(0x28b)](_0x2415df,_0x2415df+0x10)[_0x1f6071(0x232)]((_0x32f94e,_0x18dd65,_0x21458d,_0x1b7826)=>_0x21458d%0x2?_0x32f94e[_0x1f6071(0x237)](((_0x1b7826[_0x21458d-0x1]<<0x8)+_0x18dd65)[_0x1f6071(0x172)](0x10)):_0x32f94e,[])[_0x1f6071(0x289)](':'));}if(!_0x47aec4){log('error',_0x1f6071(0x267));throw new Error(_0x1f6071(0x29d));}return log('info',_0x1f6071(0x168)+_0x47aec4+':'+_0x163233),{'hostname':_0x47aec4,'port':_0x163233,'data':_0x13ffd8[_0x1f6071(0x28b)](_0x430aff),'resp':new Uint8Array([_0x53f2f7,0x0])};}async function read_atleast(_0x104578,_0x5586d6){const _0x677164=_0x56bbe2,_0x1cce4a=[];let _0x476642=![];while(_0x5586d6>0x0&&!_0x476642){const _0x1ad9e2=await _0x104578[_0x677164(0x28d)]();if(_0x1ad9e2['value']){const _0x2506a2=new Uint8Array(_0x1ad9e2[_0x677164(0x1d9)]);_0x1cce4a[_0x677164(0x1c0)](_0x2506a2),_0x5586d6-=_0x2506a2['length'];}_0x476642=_0x1ad9e2[_0x677164(0x1f3)];}if(_0x5586d6>0x0)throw new Error(_0x677164(0x27f));return{'value':concat_typed_arrays(..._0x1cce4a),'done':_0x476642};}async function parse_header(_0x52a104,_0xacedcc){const _0x19d5be=_0x56bbe2;log('debug',_0x19d5be(0x223));const _0x5b0d2c=_0xacedcc[_0x19d5be(0x2a1)]['getReader']();try{const _0x1da260=await read_vless_header(_0x5b0d2c,_0x52a104);return log('debug',_0x19d5be(0x1e9)),_0x1da260;}catch(_0x30137d){log(_0x19d5be(0x1b9),_0x19d5be(0x1da)+_0x30137d[_0x19d5be(0x173)]);throw new Error('read\x20vless\x20header\x20error:\x20'+_0x30137d['message']);}finally{_0x5b0d2c[_0x19d5be(0x204)]();}}async function connect_remote(_0x124596,_0x1a933b){const _0x2efa41=_0x56bbe2,_0x4ec6e2=0x2710;try{let _0xc55438=_0x124596;if(!/^\d+\.\d+\.\d+\.\d+$/['test'](_0x124596)&&!_0x124596['startsWith']('['))try{_0xc55438=await customDnsResolver[_0x2efa41(0x165)](_0x124596),log(_0x2efa41(0x2a4),_0x2efa41(0x19b)+_0x124596+_0x2efa41(0x22b)+_0xc55438);}catch(_0x1ee706){log(_0x2efa41(0x2a9),_0x2efa41(0x22a)+_0x124596+',\x20using\x20original\x20hostname:\x20'+_0x1ee706[_0x2efa41(0x173)]);}const _0x3e89a1=await timed_connect(_0xc55438,_0x1a933b,_0x4ec6e2);return _0x3e89a1['setNoDelay'](SETTINGS[_0x2efa41(0x231)]),_0x3e89a1[_0x2efa41(0x263)](SETTINGS[_0x2efa41(0x25c)],0x3e8),_0x3e89a1[_0x2efa41(0x1b0)]&&_0x3e89a1[_0x2efa41(0x1b0)](SETTINGS[_0x2efa41(0x18a)]),_0x3e89a1['setWriteBuffer']&&_0x3e89a1[_0x2efa41(0x253)](SETTINGS[_0x2efa41(0x194)]),_0x3e89a1['_handle']&&_0x3e89a1[_0x2efa41(0x20b)][_0x2efa41(0x295)]&&_0x3e89a1['_handle'][_0x2efa41(0x295)](!![]),log(_0x2efa41(0x20d),_0x2efa41(0x1ac)+_0x124596+'('+_0xc55438+'):'+_0x1a933b+_0x2efa41(0x265)),_0x3e89a1;}catch(_0x759a89){log(_0x2efa41(0x1b9),_0x2efa41(0x1c3)+_0x759a89['message']);throw _0x759a89;}}function timed_connect(_0x59d730,_0x4c4edf,_0xe75209){return new Promise((_0x107ace,_0x46a32d)=>{const _0xa33761=_0x1987,_0x43ea48=net[_0xa33761(0x176)]({'host':_0x59d730,'port':_0x4c4edf}),_0x2e9045=setTimeout(()=>{_0x46a32d(new Error('connect\x20timeout'));},_0xe75209);_0x43ea48['on'](_0xa33761(0x166),()=>{clearTimeout(_0x2e9045),_0x107ace(_0x43ea48);}),_0x43ea48['on'](_0xa33761(0x1b9),_0x15a999=>{clearTimeout(_0x2e9045),_0x46a32d(_0x15a999);});});}function pipe_relay(){async function _0x4d0c92(_0x5cec24,_0x9e5fe7,_0x57a82e){const _0x68cb22=_0x1987,_0x75dc10=SETTINGS[_0x68cb22(0x23e)];let _0x5efd57=0x0;const _0x3dc127=Date['now']();if(_0x57a82e[_0x68cb22(0x1a5)]>0x0){if(_0x9e5fe7[_0x68cb22(0x1c7)])_0x9e5fe7['cork'](),_0x9e5fe7[_0x68cb22(0x1c7)](_0x57a82e),process['nextTick'](()=>_0x9e5fe7[_0x68cb22(0x1a7)]()),_0x5efd57+=_0x57a82e[_0x68cb22(0x1a5)];else{const _0x40e2ef=_0x9e5fe7[_0x68cb22(0x280)][_0x68cb22(0x162)]();try{await _0x40e2ef[_0x68cb22(0x1c7)](_0x57a82e),_0x5efd57+=_0x57a82e['length'];}finally{_0x40e2ef[_0x68cb22(0x204)]();}}}try{if(_0x5cec24[_0x68cb22(0x1e4)]){_0x5cec24[_0x68cb22(0x1cf)](),_0x5cec24['_readableState'][_0x68cb22(0x28f)]=_0x75dc10;_0x9e5fe7[_0x68cb22(0x29f)]&&(_0x9e5fe7[_0x68cb22(0x29f)][_0x68cb22(0x28f)]=_0x75dc10);const {Transform:_0x32720e}=require('stream'),_0x2cbc3b=new _0x32720e({'transform'(_0x278302,_0x463556,_0x460124){const _0x30482f=_0x68cb22;_0x5efd57+=_0x278302['length'],_0x278302['length']<0x400?this[_0x30482f(0x1c0)](_0x278302):this[_0x30482f(0x1c0)](_0x278302),_0x460124();},'highWaterMark':_0x75dc10});_0x5cec24['pipe'](_0x2cbc3b)['pipe'](_0x9e5fe7,{'end':!![],'highWaterMark':_0x75dc10}),_0x5cec24['resume']();}else{const _0x452b4d=_0x5cec24[_0x68cb22(0x2a1)][_0x68cb22(0x1f4)](),_0x4f16f3=_0x9e5fe7[_0x68cb22(0x280)]['getWriter']();try{while(!![]){const {done:_0x523152,value:_0x2cd423}=await _0x452b4d[_0x68cb22(0x28d)]();if(_0x523152)break;_0x5efd57+=_0x2cd423[_0x68cb22(0x1a5)],await _0x4f16f3[_0x68cb22(0x1c7)](_0x2cd423);}}finally{_0x452b4d[_0x68cb22(0x204)](),_0x4f16f3[_0x68cb22(0x204)]();}}const _0x4c4966=Date['now']()-_0x3dc127;if(_0x5efd57>0x0&&_0x4c4966>0x0){const _0x4b1b60=Math[_0x68cb22(0x269)](_0x5efd57/_0x4c4966*0x3e8/0x400);log(_0x68cb22(0x2a4),'Transfer\x20completed:\x20'+_0x5efd57+_0x68cb22(0x1a1)+_0x4c4966+'ms\x20('+_0x4b1b60+_0x68cb22(0x1d1));}}catch(_0x378236){!_0x378236[_0x68cb22(0x173)][_0x68cb22(0x241)](_0x68cb22(0x219))&&log(_0x68cb22(0x1b9),_0x68cb22(0x189),_0x378236[_0x68cb22(0x173)]);throw _0x378236;}}return _0x4d0c92;}function socketToWebStream(_0x3a890a,_0x39926c){const _0x3cdebe=_0x56bbe2;let _0x294a07,_0x430822,_0x2a19de=![];const _0x542f22=_0x3068d3=>{const _0x4a0bd8=_0x1987;if(_0x2a19de)return;log(_0x4a0bd8(0x1b9),_0x4a0bd8(0x1f7),_0x3068d3[_0x4a0bd8(0x173)]),_0x294a07?.[_0x4a0bd8(0x1b9)](_0x3068d3),_0x430822?.[_0x4a0bd8(0x1b9)](_0x3068d3);},_0x30e339=_0x26a1d5=>{const _0xc27e39=_0x1987;if(_0x2a19de)return;try{_0x294a07?.[_0xc27e39(0x215)](_0x26a1d5);}catch(_0x292d2f){log('error',_0xc27e39(0x249),_0x292d2f[_0xc27e39(0x173)]);}},_0x3b2531=()=>{const _0xca6b41=_0x1987;if(_0x2a19de)return;try{_0x294a07?.['close']();}catch(_0x295122){log(_0xca6b41(0x1b9),_0xca6b41(0x1eb),_0x295122[_0xca6b41(0x173)]);}};return _0x3a890a['on'](_0x3cdebe(0x1b9),_0x542f22),_0x3a890a['on'](_0x3cdebe(0x27a),_0x30e339),_0x3a890a['on']('end',_0x3b2531),_0x39926c&&(_0x39926c[_0x3cdebe(0x1b3)][_0x3cdebe(0x248)]('error'),_0x39926c[_0x3cdebe(0x1b3)][_0x3cdebe(0x248)](_0x3cdebe(0x27a)),_0x39926c['eventListeners'][_0x3cdebe(0x248)](_0x3cdebe(0x1ca))),{'readable':new ReadableStream({'start'(_0x510142){_0x294a07=_0x510142;},'cancel'(){const _0x2aa71e=_0x3cdebe;_0x2a19de=!![],_0x3a890a[_0x2aa71e(0x22e)](_0x2aa71e(0x1b9),_0x542f22),_0x3a890a[_0x2aa71e(0x22e)](_0x2aa71e(0x27a),_0x30e339),_0x3a890a[_0x2aa71e(0x22e)](_0x2aa71e(0x1ca),_0x3b2531),_0x3a890a[_0x2aa71e(0x24c)]();}}),'writable':new WritableStream({'start'(_0x29c820){_0x430822=_0x29c820;},'write'(_0x571ac0){return new Promise((_0x381e09,_0x3e296c)=>{const _0xf491e2=_0x1987;if(_0x3a890a[_0xf491e2(0x1a4)]||_0x2a19de){_0x3e296c(new Error(_0xf491e2(0x1ef)));return;}_0x3a890a['write'](_0x571ac0,_0x6f8080=>{if(_0x6f8080)_0x3e296c(_0x6f8080);else _0x381e09();});});},'close'(){const _0x461594=_0x3cdebe;_0x2a19de=!![],_0x3a890a['removeListener'](_0x461594(0x1b9),_0x542f22),_0x3a890a['removeListener'](_0x461594(0x27a),_0x30e339),_0x3a890a[_0x461594(0x22e)](_0x461594(0x1ca),_0x3b2531),!_0x3a890a[_0x461594(0x1a4)]&&_0x3a890a['end']();},'abort'(_0x53aab3){const _0x143d17=_0x3cdebe;_0x2a19de=!![],_0x3a890a[_0x143d17(0x22e)](_0x143d17(0x1b9),_0x542f22),_0x3a890a[_0x143d17(0x22e)](_0x143d17(0x27a),_0x30e339),_0x3a890a[_0x143d17(0x22e)](_0x143d17(0x1ca),_0x3b2531),_0x3a890a[_0x143d17(0x24c)](_0x53aab3);}})};}function relay(_0x440ee6,_0x289dd9,_0x3a418f,_0x43bd62,_0x55565c){const _0x2d1645=_0x56bbe2,_0x596087=pipe_relay();let _0x275a92=![];const _0x56a2f9=socketToWebStream(_0x3a418f,_0x55565c);function _0x1434e1(){const _0x4c118f=_0x1987;if(!_0x275a92){_0x275a92=!![];try{_0x3a418f['destroy']();}catch(_0x271970){!_0x271970[_0x4c118f(0x173)]['includes'](_0x4c118f(0x219))&&!_0x271970[_0x4c118f(0x173)]['includes'](_0x4c118f(0x186))&&log('error',_0x4c118f(0x29b)+_0x271970[_0x4c118f(0x173)]);}}}const _0x26e103=_0x596087(_0x289dd9,_0x56a2f9,_0x43bd62[_0x2d1645(0x27a)])[_0x2d1645(0x17c)](_0xc31d57=>{const _0x1ff112=_0x2d1645;!_0xc31d57[_0x1ff112(0x173)][_0x1ff112(0x241)](_0x1ff112(0x219))&&!_0xc31d57['message']['includes']('socket\x20hang\x20up')&&log(_0x1ff112(0x1b9),_0x1ff112(0x21a)+_0xc31d57[_0x1ff112(0x173)]);})['finally'](()=>{const _0x39d273=_0x2d1645;_0x289dd9[_0x39d273(0x1f0)]&&_0x289dd9['reading_done']();}),_0x177173=_0x596087(_0x56a2f9,_0x289dd9,_0x43bd62[_0x2d1645(0x20c)])['catch'](_0x2eed99=>{const _0x39281c=_0x2d1645;!_0x2eed99[_0x39281c(0x173)]['includes'](_0x39281c(0x219))&&!_0x2eed99[_0x39281c(0x173)][_0x39281c(0x241)](_0x39281c(0x186))&&log(_0x39281c(0x1b9),_0x39281c(0x1c6)+_0x2eed99['message']);});_0x177173[_0x2d1645(0x221)](()=>_0x26e103)[_0x2d1645(0x221)](_0x1434e1);}function _0x1987(_0x1875e0,_0x308d42){const _0x27d812=_0x27d8();return _0x1987=function(_0x1987a4,_0x24109c){_0x1987a4=_0x1987a4-0x160;let _0x21532d=_0x27d812[_0x1987a4];return _0x21532d;},_0x1987(_0x1875e0,_0x308d42);}function _0x27d8(){const _0x1c4f00=['ISP\x20info\x20obtained:\x20','s,\x20Transferred:\x20','none','\x20timed\x20out\x20without\x20downstream','MAX_BUFFERED_POSTS','setServers','fill','enqueue','\x22}\x27','1.1.1.1','writableEnded','aborted','Upload\x20error:\x20','\x1b[33m','cleanupTimer','pendingBuffers','KB/s','SESSION_CLEANUP_INTERVAL','\x20-p\x20','finally','header\x20length\x20too\x20short','Starting\x20to\x20parse\x20VLESS\x20header','https://ipv6.ip.sb','Too\x20many\x20buffered\x20packets','headerSent','Created\x20new\x20session\x20for\x20POST:\x20','Log\x20level:\x20','remote','DNS\x20resolution\x20failed\x20for\x20','\x20to\x20','MB,\x20Sessions:\x20','localhost','removeListener','initializeVLESS','split','TCP_NODELAY','reduce','LOG_LEVEL','Remote\x20error:\x20','PORT','from','concat','GET,\x20POST','currentStreamRes','env','upgrade','match','Failed\x20to\x20get\x20server\x20IP,\x20using\x20localhost','CHUNK_SIZE','2822520xINzrp','&mode=packet-up#','includes','bytesTransferred','arm','https://arm64.ssss.nyc.mn/agent','getServers','No\x20addresses\x20found','7asnBcL','add','Read\x20controller\x20error:','\x20using\x20','\x20expired\x20sessions','destroy','totalBytesTransferred','set','SUB_PATH','npm\x20running\x20error:\x20','XPATH','Max\x20session\x20age:\x20','setWriteBuffer','https://amd64.ssss.nyc.mn/v1','resolve4','max','createServer','Transform','Failed\x20to\x20write\x20HTTP\x20response:\x20','Waiting\x20for\x20initialization,\x20buffering\x20packet\x20seq=','log','TCP_KEEPALIVE','get','forEach','Created\x20new\x20session\x20for\x20GET:\x20','responseHeader','arm64','\x20-\x20Duration:\x20','setKeepAlive','s,\x20Connections:\x20','\x20with\x20optimized\x20settings','Client\x20connection\x20error\x20for\x20session:\x20','Failed\x20to\x20parse\x20hostname','8443','round','url','currentServerIndex','Resolving\x20','GET','Server\x20error:\x20','7022515qnQrZg','HTTP\x20upgrade\x20request\x20received','createWriteStream','443','Initializing\x20VLESS\x20connection\x20from\x20first\x20packet','Session\x20timeout:\x20','Processed\x20pending\x20packet\x20seq=','Cleaning\x20up\x20expired\x20session:\x20','MB,\x20forcing\x20garbage\x20collection','nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&','startTime','data','2096','--tls','Resolved\x20','toISOString','not\x20enough\x20data\x20to\x20read','writable','https://amd64.ssss.nyc.mn/agent','maxConnections','Failed\x20to\x20process\x20POST\x20request:\x20','BUFFER_SIZE','vless://','_processPendingPackets','DNS\x20resolution\x20failed\x20with\x20','\x20>/dev/null\x202>&1\x20&','join','totalConnections','slice','Unknown','read','Failed\x20to\x20initialize\x20VLESS\x20connection','highWaterMark','Client\x20connection\x20closed','\x1b[0m','pop','_startDownstreamResponse','config.yaml','setNoDelay','heapUsed','Server\x20is\x20running\x20on\x20port\x20','http/1.1','dns','4662sxeFPW','Cleanup\x20error:\x20','nextSeq','parse\x20hostname\x20failed','ipv4first','_writableState','\x1b[36m','readable','Error\x20writing\x20to\x20client:\x20','HTTP/1.1\x20200\x20OK\x0d\x0a','debug','npm\x20download\x20successfully',',\x20size=','setTimeout','connection','warn','keepAliveTimeout','Chunk\x20size:\x20','Connection:\x20close\x0d\x0a','&path=','Processing\x20packet:\x20seq=','getWriter','Failed\x20to\x20get\x20server\x20info:\x20','Content-Type:\x20application/octet-stream\x0d\x0a','resolve','connect','2053','VLESS\x20connection\x20to\x20','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','http','UUID','Automatic\x20Access\x20Task\x20added\x20successfully:','requestTimeout','Error\x20starting\x20downstream:\x20','2346032ixKJcb','ENABLE_COMPRESSION','a2056d0d-c98e-4aeb-9aab-37f64edd5710','toString','message','https://ifconfig.me','After\x20GC:\x20','createConnection','country','downstreamStarted','IPv6\x20fallback\x20failed:','Hello,\x20World\x0a','headersSent','catch','\x20bytes','Mozilla/5.0\x20(Windows\x20NT\x2010.0;\x20Win64;\x20x64)\x20AppleWebKit/537.36','Remote\x20connection\x20established','&fp=chrome&allowInsecure=1&type=xhttp&host=','socket','Server\x20info:\x20IP=','https://ipinfo.io/ip','Session\x20','\x20using\x20DNS\x20server:\x20','socket\x20hang\x20up','Failed\x20to\x20write\x20VLESS\x20response:\x20','npm','Relay\x20error:','READ_BUFFER_SIZE','Failed\x20to\x20get\x20IP\x20from\x20','Failed\x20to\x20get\x20ISP\x20info:\x20','DNS\x20servers:\x201.1.1.1,\x208.8.8.8','writeHead','2087','vlessHeader','\x20from\x20','Performance\x20Stats\x20-\x20Uptime:\x20','Sending\x20VLESS\x20response\x20header\x20(','WRITE_BUFFER_SIZE','then','SESSION_TIMEOUT','Got\x20server\x20IP:\x20','cleaned','MB,\x20RSS\x20','asOrganization','DNS\x20resolved\x20','Process\x20packet\x20error:\x20','\x0aclient_secret:\x20','child_process','HTTP\x20Hijacking\x20not\x20supported','false','\x20bytes\x20in\x20','552wWvpGp','Sent\x20HTTP\x20response\x20header\x20for\x20session:\x20','destroyed','length','NAME','uncork','curl\x20-X\x20POST\x20\x22https://oooo.serv00.net/add-url\x22\x20-H\x20\x22Content-Type:\x20application/json\x22\x20-d\x20\x27{\x22url\x22:\x20\x22','\x1b[31m','startDownstream','port','Connected\x20to\x20','https://ipv4.ip.sb','Created\x20new\x20session\x20with\x20UUID:\x20','uuid','setReadBuffer','memoryUsage','Memory:\x20Heap\x20','eventListeners','cleanup','now','clear','Cleaning\x20up\x20session\x20','close','error','constructor','processPacket','\x0askip_connection_count:\x20false\x0askip_procs_count:\x20false\x0atemperature:\x20false\x0atls:\x20','DOMAIN','pendingPackets','stream','push','rss','=================================','Connection\x20failed:\x20','4821234FTuCnU','writeFileSync','Download\x20error:\x20','write','https://speed.cloudflare.com/meta','replaceAll','end','no-store','https://arm64.ssss.nyc.mn/v1','Cleaned\x20up\x20','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20false\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20','pause','AUTO_ACCESS','\x20KB/s)','Error\x20writing\x20to\x20remote:\x20','aarch64','timeout','BATCH_PROCESS_SIZE','MAX_POST_SIZE','listen','14466168shoPXY','value','VLESS\x20header\x20parse\x20error:\x20','removeAllListeners','MAX_SESSION_AGE','axios','size','buffer','invalid\x20UUID','KB,\x20Speed:\x20','https://','peakMemoryUsage','pipe','):\x20','setDefaultResultOrder','%2F','sort','VLESS\x20header\x20parsed\x20successfully','Unknown_ISP','Read\x20controller\x20close\x20error:','lastActivity','2083','NEZHA_SERVER','Socket\x20is\x20destroyed','reading_done','initialized','activeConnections','done','getReader','36307dguDHN','headersTimeout','Socket\x20error:','method','text/plain','MB\x20(freed\x20','replace','alpnProtocol','delete','8.8.8.8','High\x20memory\x20usage\x20detected:\x20','resolveWithServer','_writeToRemote','bufferedData',']\x20[','releaseLock',',\x20Speed:\x20','Max\x20buffered\x20posts:\x20','8192','reset','Client\x20connection\x20closed\x20for\x20session:\x20','All\x20DNS\x20servers\x20failed.\x20Last\x20error:\x20','_handle','resp','info'];_0x27d8=function(){return _0x1c4f00;};return _0x27d8();}const sessions=new Map();function cleanupExpiredSessions(){const _0x28af0c=_0x56bbe2,_0x183f7f=Date[_0x28af0c(0x1b5)](),_0x532b1e=[];for(const [_0x265bbc,_0x565f28]of sessions){_0x183f7f-_0x565f28[_0x28af0c(0x1ec)]>SETTINGS[_0x28af0c(0x1dc)]&&_0x532b1e[_0x28af0c(0x1c0)](_0x265bbc);}for(const _0x382280 of _0x532b1e){const _0x44af81=sessions[_0x28af0c(0x25d)](_0x382280);_0x44af81&&(log('debug',_0x28af0c(0x276)+_0x382280),_0x44af81['cleanup']());}_0x532b1e[_0x28af0c(0x1a5)]>0x0&&log(_0x28af0c(0x20d),_0x28af0c(0x1cd)+_0x532b1e[_0x28af0c(0x1a5)]+_0x28af0c(0x24b));}setInterval(cleanupExpiredSessions,SETTINGS[_0x56bbe2(0x21f)]);const performanceStats={'totalConnections':0x0,'activeConnections':0x0,'totalBytesTransferred':0x0,'averageSpeed':0x0,'peakMemoryUsage':0x0,'startTime':Date[_0x56bbe2(0x1b5)]()};function monitorMemory(){const _0x55b104=_0x56bbe2,_0x5105a0=process[_0x55b104(0x1b1)](),_0x3dc42e=Math[_0x55b104(0x269)](_0x5105a0[_0x55b104(0x296)]/0x400/0x400),_0x4bad33=Math[_0x55b104(0x269)](_0x5105a0[_0x55b104(0x1c1)]/0x400/0x400);performanceStats[_0x55b104(0x1e3)]=Math[_0x55b104(0x256)](performanceStats[_0x55b104(0x1e3)],_0x3dc42e);const _0x5e159e=Math[_0x55b104(0x269)]((Date[_0x55b104(0x1b5)]()-performanceStats[_0x55b104(0x279)])/0x3e8),_0xb2767d=performanceStats['totalBytesTransferred']>0x0?Math[_0x55b104(0x269)](performanceStats[_0x55b104(0x24d)]/_0x5e159e/0x400):0x0;log(_0x55b104(0x2a4),_0x55b104(0x1b2)+_0x3dc42e+_0x55b104(0x199)+_0x4bad33+_0x55b104(0x22c)+sessions[_0x55b104(0x1de)]+_0x55b104(0x205)+_0xb2767d+_0x55b104(0x21e));if(_0x3dc42e>0x1f4){log(_0x55b104(0x2a9),_0x55b104(0x1ff)+_0x3dc42e+_0x55b104(0x277));if(global['gc']){global['gc']();const _0x5f40e5=process[_0x55b104(0x1b1)](),_0x583f0c=Math[_0x55b104(0x269)](_0x5f40e5[_0x55b104(0x296)]/0x400/0x400);log('info',_0x55b104(0x175)+_0x583f0c+_0x55b104(0x1fa)+(_0x3dc42e-_0x583f0c)+'MB)');}}}function logPerformanceStats(){const _0x18ceab=_0x56bbe2,_0x29f0bd=Math[_0x18ceab(0x269)]((Date[_0x18ceab(0x1b5)]()-performanceStats['startTime'])/0x3e8),_0x1a2029=performanceStats[_0x18ceab(0x24d)]>0x0?Math[_0x18ceab(0x269)](performanceStats['totalBytesTransferred']/_0x29f0bd/0x400):0x0;log(_0x18ceab(0x20d),_0x18ceab(0x192)+_0x29f0bd+_0x18ceab(0x264)+performanceStats[_0x18ceab(0x28a)]+',\x20Active:\x20'+sessions['size']+',\x20Transferred:\x20'+Math[_0x18ceab(0x269)](performanceStats['totalBytesTransferred']/0x400/0x400)+'MB,\x20Avg\x20Speed:\x20'+_0x1a2029+'KB/s,\x20Peak\x20Memory:\x20'+performanceStats[_0x18ceab(0x1e3)]+'MB');}setInterval(monitorMemory,0x7530),setInterval(logPerformanceStats,0x493e0);class Session{constructor(_0x565884){const _0x31d666=_0x56bbe2;this[_0x31d666(0x1af)]=_0x565884,this[_0x31d666(0x29c)]=0x0,this[_0x31d666(0x178)]=![],this[_0x31d666(0x1ec)]=Date[_0x31d666(0x1b5)](),this[_0x31d666(0x190)]=null,this[_0x31d666(0x229)]=null,this[_0x31d666(0x1f1)]=![],this['responseHeader']=null,this[_0x31d666(0x226)]=![],this[_0x31d666(0x202)]=new Map(),this[_0x31d666(0x198)]=![],this[_0x31d666(0x1be)]=[],this[_0x31d666(0x239)]=null,this['pendingBuffers']=new Map(),this[_0x31d666(0x21c)]=null,this['eventListeners']=new Set(),this[_0x31d666(0x242)]=0x0,this['startTime']=Date[_0x31d666(0x1b5)](),log(_0x31d666(0x2a4),_0x31d666(0x1ae)+_0x565884),performanceStats['totalConnections']++,performanceStats[_0x31d666(0x1f2)]++,this['cleanupTimer']=setTimeout(()=>{const _0x37732b=_0x31d666;this[_0x37732b(0x1b4)]();},SETTINGS[_0x31d666(0x1dc)]);}async[_0x56bbe2(0x22f)](_0x2ef806){const _0x40ab4c=_0x56bbe2;if(this[_0x40ab4c(0x1f1)])return!![];try{log(_0x40ab4c(0x2a4),_0x40ab4c(0x273));const _0x80e492=new ReadableStream({'start'(_0x16fa04){const _0x9f9525=_0x40ab4c;_0x16fa04[_0x9f9525(0x215)](_0x2ef806),_0x16fa04['close']();}}),_0x2a80d9={'readable':_0x80e492,'writable':new WritableStream()};return this[_0x40ab4c(0x190)]=await parse_header(SETTINGS['UUID'],_0x2a80d9),log(_0x40ab4c(0x20d),'VLESS\x20header\x20parsed:\x20'+this[_0x40ab4c(0x190)]['hostname']+':'+this['vlessHeader'][_0x40ab4c(0x1ab)]),this[_0x40ab4c(0x229)]=await connect_remote(this[_0x40ab4c(0x190)]['hostname'],this[_0x40ab4c(0x190)][_0x40ab4c(0x1ab)]),log('info',_0x40ab4c(0x17f)),this['initialized']=!![],!![];}catch(_0x1a3460){return log(_0x40ab4c(0x1b9),'Failed\x20to\x20initialize\x20VLESS:\x20'+_0x1a3460['message']),![];}}async[_0x56bbe2(0x1bb)](_0x3a1490,_0x543588){const _0x58847f=_0x56bbe2;try{this[_0x58847f(0x1ec)]=Date[_0x58847f(0x1b5)](),this[_0x58847f(0x21d)][_0x58847f(0x24e)](_0x3a1490,_0x543588),log(_0x58847f(0x2a4),'Buffered\x20packet\x20seq='+_0x3a1490+_0x58847f(0x2a6)+_0x543588[_0x58847f(0x1a5)]);if(_0x3a1490===0x0&&!this[_0x58847f(0x1f1)]){const _0x16bab0=this[_0x58847f(0x21d)][_0x58847f(0x25d)](0x0);this[_0x58847f(0x21d)][_0x58847f(0x1fd)](0x0);if(!await this['initializeVLESS'](_0x16bab0))throw new Error(_0x58847f(0x28e));return this[_0x58847f(0x260)]=Buffer['from']([0x0,0x0]),await this['_writeToRemote'](this[_0x58847f(0x190)][_0x58847f(0x27a)]),await this['_processPendingPackets'](),!![];}if(this[_0x58847f(0x1f1)])return await this[_0x58847f(0x201)](_0x543588),!![];if(!this['initialized'])return log('debug',_0x58847f(0x25a)+_0x3a1490),!![];if(this[_0x58847f(0x21d)]['size']>SETTINGS[_0x58847f(0x212)])throw new Error(_0x58847f(0x225));return!![];}catch(_0x22a0f7){log(_0x58847f(0x1b9),_0x58847f(0x19c)+_0x22a0f7[_0x58847f(0x173)]);throw _0x22a0f7;}}async[_0x56bbe2(0x286)](){const _0x55dbad=_0x56bbe2,_0x3e2489=Array['from'](this['pendingBuffers']['keys']())[_0x55dbad(0x1e8)]((_0xd8a666,_0x528b64)=>_0xd8a666-_0x528b64);for(const _0x5efffd of _0x3e2489){if(_0x5efffd>0x0){const _0x12f531=this[_0x55dbad(0x21d)][_0x55dbad(0x25d)](_0x5efffd);this[_0x55dbad(0x21d)][_0x55dbad(0x1fd)](_0x5efffd),this[_0x55dbad(0x1f1)]&&(await this['_writeToRemote'](_0x12f531),log('debug',_0x55dbad(0x275)+_0x5efffd));}}}[_0x56bbe2(0x293)](){const _0x33a45d=_0x56bbe2;if(!this['currentStreamRes']||!this[_0x33a45d(0x260)])return;try{const _0x1ffe96=this[_0x33a45d(0x239)][_0x33a45d(0x181)]?.[_0x33a45d(0x1fc)]||_0x33a45d(0x298),_0x298238=_0x1ffe96==='h2';!this[_0x33a45d(0x226)]&&(log(_0x33a45d(0x2a4),_0x33a45d(0x193)+_0x1ffe96+_0x33a45d(0x1e5)+this[_0x33a45d(0x260)]['length']+_0x33a45d(0x17d)),this['currentStreamRes']['write'](this['responseHeader']),this[_0x33a45d(0x226)]=!![]);if(_0x298238){this[_0x33a45d(0x239)][_0x33a45d(0x181)][_0x33a45d(0x295)](!![]);const _0x309c61=new require(_0x33a45d(0x1bf))[_0x33a45d(0x258)]({'transform'(_0x56c24f,_0x4d0b32,_0x533b1a){const _0x22b639=_0x33a45d,_0x335feb=0x4000;for(let _0x396044=0x0;_0x396044<_0x56c24f['length'];_0x396044+=_0x335feb){this[_0x22b639(0x1c0)](_0x56c24f[_0x22b639(0x28b)](_0x396044,_0x396044+_0x335feb));}_0x533b1a();}});this[_0x33a45d(0x229)]['pipe'](_0x309c61)[_0x33a45d(0x1e4)](this[_0x33a45d(0x239)]);}else this['remote'][_0x33a45d(0x1e4)](this[_0x33a45d(0x239)]);this['remote']['on'](_0x33a45d(0x1ca),()=>{const _0x2ecc21=_0x33a45d;!this['currentStreamRes'][_0x2ecc21(0x218)]&&this[_0x2ecc21(0x239)]['end']();}),this[_0x33a45d(0x229)]['on'](_0x33a45d(0x1b9),_0x11f12c=>{const _0x264894=_0x33a45d;log('error',_0x264894(0x234)+_0x11f12c['message']),!this[_0x264894(0x239)][_0x264894(0x218)]&&this[_0x264894(0x239)][_0x264894(0x1ca)]();});}catch(_0x190f9d){log(_0x33a45d(0x1b9),_0x33a45d(0x16e)+_0x190f9d[_0x33a45d(0x173)]),this['cleanup']();}}[_0x56bbe2(0x1aa)](_0x3e69dd,_0x1c5f4b){const _0x5a218e=_0x56bbe2;!_0x3e69dd[_0x5a218e(0x17b)]&&_0x3e69dd['writeHead'](0xc8,_0x1c5f4b);this[_0x5a218e(0x239)]=_0x3e69dd;this['initialized']&&this['responseHeader']&&this[_0x5a218e(0x293)]();const _0x15f83c=()=>{const _0x10661f=_0x5a218e;log(_0x10661f(0x20d),_0x10661f(0x290)),this[_0x10661f(0x1b4)]();};return _0x3e69dd['on'](_0x5a218e(0x1b8),_0x15f83c),this[_0x5a218e(0x1b3)][_0x5a218e(0x248)](_0x5a218e(0x1b8)),this['lastActivity']=Date[_0x5a218e(0x1b5)](),!![];}async[_0x56bbe2(0x201)](_0x3c555f){const _0xdbef3b=_0x56bbe2;if(!this['remote']||this[_0xdbef3b(0x229)][_0xdbef3b(0x1a4)])throw new Error('Remote\x20connection\x20not\x20available');return new Promise((_0x1170c3,_0xd1141e)=>{const _0x2a2192=_0xdbef3b;this[_0x2a2192(0x229)][_0x2a2192(0x1c7)](_0x3c555f,_0x9fed85=>{const _0x3d077d=_0x2a2192;_0x9fed85?(log(_0x3d077d(0x1b9),'Failed\x20to\x20write\x20to\x20remote:\x20'+_0x9fed85[_0x3d077d(0x173)]),_0xd1141e(_0x9fed85)):(this[_0x3d077d(0x242)]+=_0x3c555f[_0x3d077d(0x1a5)],_0x1170c3());});});}[_0x56bbe2(0x293)](){const _0x309b8f=_0x56bbe2;if(!this[_0x309b8f(0x239)]||!this[_0x309b8f(0x260)])return;try{!this[_0x309b8f(0x226)]&&(this[_0x309b8f(0x239)][_0x309b8f(0x1c7)](this['responseHeader']),this[_0x309b8f(0x226)]=!![]);this[_0x309b8f(0x229)]['pipe'](this[_0x309b8f(0x239)]);const _0x22cfef=()=>{const _0x4f46d2=_0x309b8f;!this[_0x4f46d2(0x239)][_0x4f46d2(0x218)]&&this[_0x4f46d2(0x239)]['end']();},_0x48a546=_0x12b6de=>{const _0x5ad04f=_0x309b8f;log(_0x5ad04f(0x1b9),_0x5ad04f(0x234)+_0x12b6de[_0x5ad04f(0x173)]),!this[_0x5ad04f(0x239)]['writableEnded']&&this[_0x5ad04f(0x239)][_0x5ad04f(0x1ca)]();};this[_0x309b8f(0x229)]['on'](_0x309b8f(0x1ca),_0x22cfef),this[_0x309b8f(0x229)]['on'](_0x309b8f(0x1b9),_0x48a546),this[_0x309b8f(0x1b3)]['add'](_0x309b8f(0x1ca)),this[_0x309b8f(0x1b3)]['add'](_0x309b8f(0x1b9));}catch(_0x3d277c){log('error',_0x309b8f(0x16e)+_0x3d277c[_0x309b8f(0x173)]),this[_0x309b8f(0x1b4)]();}}[_0x56bbe2(0x1b4)](){const _0x36e422=_0x56bbe2;if(!this['cleaned']){this[_0x36e422(0x198)]=!![],performanceStats[_0x36e422(0x24d)]+=this[_0x36e422(0x242)],performanceStats[_0x36e422(0x1f2)]--;const _0x49cea5=Date['now']()-this[_0x36e422(0x279)],_0x1f9cb5=this[_0x36e422(0x242)]>0x0?Math[_0x36e422(0x269)](this['bytesTransferred']/_0x49cea5*0x3e8/0x400):0x0;log('debug',_0x36e422(0x1b7)+this[_0x36e422(0x1af)]+_0x36e422(0x262)+Math[_0x36e422(0x269)](_0x49cea5/0x3e8)+_0x36e422(0x20f)+Math[_0x36e422(0x269)](this[_0x36e422(0x242)]/0x400)+_0x36e422(0x1e1)+_0x1f9cb5+_0x36e422(0x21e)),this[_0x36e422(0x21c)]&&(clearTimeout(this[_0x36e422(0x21c)]),this[_0x36e422(0x21c)]=null),this[_0x36e422(0x229)]&&(this[_0x36e422(0x229)][_0x36e422(0x1db)](),this['remote'][_0x36e422(0x24c)](),this[_0x36e422(0x229)]=null),this[_0x36e422(0x239)]&&(this[_0x36e422(0x239)][_0x36e422(0x1db)](),this[_0x36e422(0x239)]=null),this[_0x36e422(0x21d)][_0x36e422(0x1b6)](),this[_0x36e422(0x202)][_0x36e422(0x1b6)](),this[_0x36e422(0x1be)]=[],this[_0x36e422(0x1b3)][_0x36e422(0x1b6)](),this[_0x36e422(0x1f1)]=![],this['headerSent']=![],sessions[_0x36e422(0x1fd)](this[_0x36e422(0x1af)]);}}}async function getISPInfo(){const _0x373cc0=_0x56bbe2;try{const _0x583d95=await axios[_0x373cc0(0x25d)](_0x373cc0(0x1c8),{'timeout':0x1f40,'headers':{'User-Agent':_0x373cc0(0x17e)}}),_0x205e8d=_0x583d95[_0x373cc0(0x27a)],_0x379cee=_0x205e8d[_0x373cc0(0x177)]||_0x373cc0(0x28c),_0x1fa6a3=_0x205e8d[_0x373cc0(0x19a)]||_0x373cc0(0x28c),_0x4ba209=(_0x379cee+'-'+_0x1fa6a3)[_0x373cc0(0x1fb)](/[^a-zA-Z0-9\-_]/g,'_');return log('info',_0x373cc0(0x20e)+_0x4ba209),_0x4ba209;}catch(_0x1ca109){return log('error',_0x373cc0(0x18c)+_0x1ca109[_0x373cc0(0x173)]),_0x373cc0(0x1ea);}}async function getServerIP(){const _0x253849=_0x56bbe2;if(DOMAIN)return DOMAIN;const _0x6830d4=[_0x253849(0x1ad),_0x253849(0x183),_0x253849(0x174)];for(const _0x17e4fb of _0x6830d4){try{const _0x619525=await axios[_0x253849(0x25d)](_0x17e4fb,{'timeout':0x1388,'headers':{'User-Agent':'Mozilla/5.0\x20(Windows\x20NT\x2010.0;\x20Win64;\x20x64)\x20AppleWebKit/537.36'}}),_0x22a09b=_0x619525[_0x253849(0x27a)]['trim']();if(_0x22a09b&&/^\d+\.\d+\.\d+\.\d+$/['test'](_0x22a09b))return log('info',_0x253849(0x197)+_0x22a09b+_0x253849(0x191)+_0x17e4fb),_0x22a09b;}catch(_0x55fe37){log(_0x253849(0x2a4),_0x253849(0x18b)+_0x17e4fb+':\x20'+_0x55fe37[_0x253849(0x173)]);}}try{const _0x580eb1=await axios[_0x253849(0x25d)](_0x253849(0x224),{'timeout':0x1388,'headers':{'User-Agent':'Mozilla/5.0\x20(Windows\x20NT\x2010.0;\x20Win64;\x20x64)\x20AppleWebKit/537.36'}}),_0x1ec965=_0x580eb1[_0x253849(0x27a)]['trim']();if(_0x1ec965)return log(_0x253849(0x20d),'Got\x20IPv6\x20address:\x20'+_0x1ec965),'['+_0x1ec965+']';}catch(_0x47e6d7){log('debug',_0x253849(0x179),_0x47e6d7[_0x253849(0x173)]);}return log('warn',_0x253849(0x23d)),_0x253849(0x22d);}let IP='localhost',ISP=_0x56bbe2(0x1ea);Promise['all']([getServerIP()[_0x56bbe2(0x195)](_0x3013c0=>{IP=_0x3013c0;}),getISPInfo()['then'](_0xb9d913=>{ISP=_0xb9d913;})])[_0x56bbe2(0x195)](()=>{const _0x57183e=_0x56bbe2;log('info',_0x57183e(0x182)+IP+',\x20ISP='+ISP);})[_0x56bbe2(0x17c)](_0x135bc2=>{const _0x4ee7d9=_0x56bbe2;log(_0x4ee7d9(0x1b9),_0x4ee7d9(0x163)+_0x135bc2['message']);});const server=http[_0x56bbe2(0x257)]((_0x483d9c,_0x2a212f)=>{const _0x340773=_0x56bbe2,_0x3aced2={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':_0x340773(0x238),'Cache-Control':_0x340773(0x1cb),'X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x483d9c[_0x340773(0x26a)]==='/'){_0x2a212f['writeHead'](0xc8,{'Content-Type':_0x340773(0x1f9)}),_0x2a212f[_0x340773(0x1ca)](_0x340773(0x17a));return;}if(_0x483d9c[_0x340773(0x26a)]==='/'+SUB_PATH){const _0x128322=NAME?NAME+'-'+ISP:ISP,_0x43e01b=_0x340773(0x285)+UUID+'@'+IP+':443?encryption=none&security=tls&sni='+IP+_0x340773(0x180)+IP+_0x340773(0x160)+SETTINGS[_0x340773(0x251)]+_0x340773(0x240)+_0x128322,_0x301c77=Buffer[_0x340773(0x236)](_0x43e01b)['toString']('base64');_0x2a212f[_0x340773(0x18e)](0xc8,{'Content-Type':'text/plain'}),_0x2a212f[_0x340773(0x1ca)](_0x301c77+'\x0a');return;}const _0x193bc0=_0x483d9c['url'][_0x340773(0x23c)](new RegExp(XPATH+'/([^/]+)(?:/([0-9]+))?$'));if(!_0x193bc0){_0x2a212f[_0x340773(0x18e)](0x194),_0x2a212f[_0x340773(0x1ca)]();return;}const _0xc1dc05=_0x193bc0[0x1],_0x3daed0=_0x193bc0[0x2]?parseInt(_0x193bc0[0x2]):null;if(_0x483d9c[_0x340773(0x1f8)]===_0x340773(0x26d)&&!_0x3daed0){const _0x50c098=_0x2a212f[_0x340773(0x181)];if(!_0x50c098){log(_0x340773(0x1b9),_0x340773(0x19f)),_0x2a212f[_0x340773(0x18e)](0x1f4),_0x2a212f[_0x340773(0x1ca)]();return;}let _0x4c8fb=sessions['get'](_0xc1dc05);!_0x4c8fb&&(_0x4c8fb=new Session(_0xc1dc05),sessions[_0x340773(0x24e)](_0xc1dc05,_0x4c8fb),log(_0x340773(0x20d),_0x340773(0x25f)+_0xc1dc05));_0x4c8fb[_0x340773(0x178)]=!![];const _0x320080=_0x340773(0x2a3)+_0x340773(0x164)+_0x340773(0x2ac)+'\x0d\x0a';try{_0x50c098['write'](_0x320080),log(_0x340773(0x2a4),_0x340773(0x1a3)+_0xc1dc05);}catch(_0x562f01){log('error',_0x340773(0x259)+_0x562f01[_0x340773(0x173)]),_0x4c8fb['cleanup']();return;}let _0x202419=0x0;const _0xff4d5c=0x258,_0x2cf564=()=>{const _0x152a87=_0x340773;if(_0x4c8fb['initialized']&&_0x4c8fb['responseHeader'])try{_0x50c098[_0x152a87(0x1c7)](_0x4c8fb[_0x152a87(0x260)]),log(_0x152a87(0x2a4),'Sent\x20VLESS\x20response\x20header\x20for\x20session:\x20'+_0xc1dc05),_0x4c8fb[_0x152a87(0x229)]['on'](_0x152a87(0x27a),_0x5c4012=>{const _0x5684b2=_0x152a87;try{!_0x50c098[_0x5684b2(0x1a4)]&&_0x50c098[_0x5684b2(0x1c7)](_0x5c4012);}catch(_0xecec42){log(_0x5684b2(0x2a4),_0x5684b2(0x2a2)+_0xecec42['message']),_0x4c8fb['cleanup']();}}),_0x50c098['on']('data',_0x54fbf1=>{const _0x11a86f=_0x152a87;try{!_0x4c8fb[_0x11a86f(0x229)]['destroyed']&&_0x4c8fb[_0x11a86f(0x229)][_0x11a86f(0x1c7)](_0x54fbf1);}catch(_0x1ef88d){log(_0x11a86f(0x2a4),_0x11a86f(0x1d2)+_0x1ef88d[_0x11a86f(0x173)]),_0x4c8fb['cleanup']();}}),_0x4c8fb[_0x152a87(0x229)]['on'](_0x152a87(0x1b8),()=>{const _0x3a9f13=_0x152a87;!_0x50c098[_0x3a9f13(0x1a4)]&&_0x50c098['end']();}),_0x4c8fb[_0x152a87(0x229)]['on'](_0x152a87(0x1b9),_0xce8b67=>{const _0x1b6e28=_0x152a87;log(_0x1b6e28(0x2a4),'Remote\x20connection\x20error:\x20'+_0xce8b67['message']),!_0x50c098['destroyed']&&_0x50c098[_0x1b6e28(0x1ca)]();}),_0x50c098['on']('close',()=>{const _0x54818a=_0x152a87;log(_0x54818a(0x2a4),_0x54818a(0x209)+_0xc1dc05),_0x4c8fb['cleanup']();}),_0x50c098['on'](_0x152a87(0x1b9),_0x3f77e5=>{const _0x409872=_0x152a87;log('debug',_0x409872(0x266)+_0xc1dc05+':\x20'+_0x3f77e5[_0x409872(0x173)]),_0x4c8fb[_0x409872(0x1b4)]();});}catch(_0x32a395){log(_0x152a87(0x1b9),_0x152a87(0x187)+_0x32a395['message']),_0x4c8fb[_0x152a87(0x1b4)]();}else _0x202419<_0xff4d5c?(_0x202419++,setTimeout(_0x2cf564,0x32)):(log(_0x152a87(0x1b9),'Session\x20initialization\x20timeout\x20for:\x20'+_0xc1dc05),_0x4c8fb[_0x152a87(0x1b4)](),_0x50c098['end']());};_0x2cf564();return;}if(_0x483d9c[_0x340773(0x1f8)]==='POST'&&_0x3daed0!==null){let _0x4de184=sessions[_0x340773(0x25d)](_0xc1dc05);!_0x4de184&&(_0x4de184=new Session(_0xc1dc05),sessions[_0x340773(0x24e)](_0xc1dc05,_0x4de184),log('info',_0x340773(0x227)+_0xc1dc05),setTimeout(()=>{const _0x342909=_0x340773,_0x165c99=sessions[_0x342909(0x25d)](_0xc1dc05);_0x165c99&&!_0x165c99['downstreamStarted']&&(log('warn',_0x342909(0x184)+_0xc1dc05+_0x342909(0x211)),_0x165c99[_0x342909(0x1b4)]());},SETTINGS['SESSION_TIMEOUT']));let _0x4dc493=[],_0x28e066=0x0,_0x24fc0d=![];_0x483d9c['on']('data',_0x8266df=>{const _0x35dd67=_0x340773;_0x28e066+=_0x8266df['length'];if(_0x28e066>SETTINGS[_0x35dd67(0x1d6)]){!_0x24fc0d&&(_0x2a212f['writeHead'](0x19d),_0x2a212f['end'](),_0x24fc0d=!![]);return;}_0x4dc493[_0x35dd67(0x1c0)](_0x8266df);}),_0x483d9c['on'](_0x340773(0x1ca),async()=>{const _0x5d53e1=_0x340773;if(_0x24fc0d)return;try{const _0x11bf63=Buffer[_0x5d53e1(0x237)](_0x4dc493);log(_0x5d53e1(0x20d),_0x5d53e1(0x161)+_0x3daed0+_0x5d53e1(0x2a6)+_0x11bf63['length']),await _0x4de184['processPacket'](_0x3daed0,_0x11bf63),!_0x24fc0d&&(_0x2a212f[_0x5d53e1(0x18e)](0xc8,_0x3aced2),_0x24fc0d=!![]),_0x2a212f[_0x5d53e1(0x1ca)]();}catch(_0x122c3){log('error',_0x5d53e1(0x283)+_0x122c3['message']),_0x4de184[_0x5d53e1(0x1b4)](),!_0x24fc0d&&(_0x2a212f[_0x5d53e1(0x18e)](0x1f4),_0x24fc0d=!![]),_0x2a212f[_0x5d53e1(0x1ca)]();}});return;}_0x2a212f[_0x340773(0x18e)](0x194),_0x2a212f[_0x340773(0x1ca)]();});server['on']('secureConnection',_0x520a8f=>{const _0xfc5b76=_0x56bbe2;log(_0xfc5b76(0x2a4),'New\x20secure\x20connection\x20using:\x20'+(_0x520a8f[_0xfc5b76(0x1fc)]||_0xfc5b76(0x298)));});function generatePadding(_0x43cc96,_0x3935be){const _0x45b2dc=_0x56bbe2,_0x5093dd=_0x43cc96+Math['floor'](Math['random']()*(_0x3935be-_0x43cc96));return Buffer[_0x45b2dc(0x236)](Array(_0x5093dd)[_0x45b2dc(0x214)]('X')[_0x45b2dc(0x289)](''))[_0x45b2dc(0x172)]('base64');}server[_0x56bbe2(0x2aa)]=0x493e0,server[_0x56bbe2(0x1f6)]=0xea60,server[_0x56bbe2(0x16d)]=0x493e0,server[_0x56bbe2(0x1d4)]=0x493e0,server[_0x56bbe2(0x282)]=0x3e8,server['on'](_0x56bbe2(0x23b),(_0x1282e7,_0x101e1a,_0x88183d)=>{const _0x573a86=_0x56bbe2;log(_0x573a86(0x2a4),_0x573a86(0x270));}),server['on'](_0x56bbe2(0x2a8),_0x5de033=>{const _0x153b59=_0x56bbe2;_0x5de033[_0x153b59(0x295)](!![]),_0x5de033[_0x153b59(0x263)](!![],0x3e8),_0x5de033[_0x153b59(0x2a7)](0x493e0),_0x5de033[_0x153b59(0x1b0)]&&_0x5de033[_0x153b59(0x1b0)](SETTINGS[_0x153b59(0x18a)]),_0x5de033['setWriteBuffer']&&_0x5de033[_0x153b59(0x253)](SETTINGS[_0x153b59(0x194)]);}),server['on']('error',_0x47af0a=>{const _0x557abf=_0x56bbe2;log(_0x557abf(0x1b9),_0x557abf(0x26e)+_0x47af0a[_0x557abf(0x173)]);});const delFiles=()=>{const _0x11a99a=_0x56bbe2;[_0x11a99a(0x188),_0x11a99a(0x294)][_0x11a99a(0x25e)](_0x1968ba=>fs['unlink'](_0x1968ba,()=>{}));};server[_0x56bbe2(0x1d7)](PORT,()=>{const _0x2b4ca5=_0x56bbe2;runnz(),setTimeout(()=>{delFiles();},0x493e0),addAccessTask(),log(_0x2b4ca5(0x20d),'================================='),log(_0x2b4ca5(0x20d),_0x2b4ca5(0x228)+SETTINGS[_0x2b4ca5(0x233)]),log('info',_0x2b4ca5(0x206)+SETTINGS[_0x2b4ca5(0x212)]),log(_0x2b4ca5(0x20d),'Max\x20POST\x20size:\x20'+Math[_0x2b4ca5(0x269)](SETTINGS[_0x2b4ca5(0x1d6)]/0x400)+'KB'),log(_0x2b4ca5(0x20d),'Buffer\x20size:\x20'+SETTINGS['BUFFER_SIZE']+'KB'),log('info',_0x2b4ca5(0x2ab)+Math['round'](SETTINGS[_0x2b4ca5(0x23e)]/0x400)+'KB'),log(_0x2b4ca5(0x20d),_0x2b4ca5(0x274)+SETTINGS[_0x2b4ca5(0x196)]+'ms'),log(_0x2b4ca5(0x20d),'Session\x20cleanup\x20interval:\x20'+SETTINGS[_0x2b4ca5(0x21f)]+'ms'),log(_0x2b4ca5(0x20d),_0x2b4ca5(0x252)+SETTINGS[_0x2b4ca5(0x1dc)]+'ms'),log(_0x2b4ca5(0x20d),'Batch\x20process\x20size:\x20'+SETTINGS[_0x2b4ca5(0x1d5)]),log(_0x2b4ca5(0x20d),_0x2b4ca5(0x18d)),log('info',_0x2b4ca5(0x1c2)),console['log'](_0x2b4ca5(0x297)+PORT);});
